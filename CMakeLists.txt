#TODO -- Currently using enviroment variables for HYPRE_INC, HYPRE_LIB, METIS_INC, METIS_LIB, MFEM_INC, MFEM_LIB (or HYPRE_DIR, METIS_DIR, MFEM_DIR).  Should we be using something else?

cmake_minimum_required(VERSION 2.8)
project(raptor)
list(APPEND CMAKE_MODULE_PATH ${CMAKE_SOURCE_DIR}/cmake)

include(options)
include(testing)
include(cxx11)
include(source)
include(mpi_config)
include(cxx_config)
include(FeatureSummary)

include_directories("external")
set(raptor_INCDIR ${CMAKE_CURRENT_SOURCE_DIR}/raptor)
set(LIBRARY_OUTPUT_PATH ${PROJECT_BINARY_DIR}/lib)

option(WITH_HYPRE "Add Hypre" OFF)
option(WITH_MFEM "Add MFEM" OFF)
option(WITH_AMPI "Using AMPI" OFF)
add_feature_info(hypre WITH_HYPRE "Hypre preconditioner")
add_feature_info(mfem WITH_MFEM "MFEM matrix gallery")
add_feature_info(ampi WITH_AMPI "Compile with AMPI")

SET(HYPRE_DIR "" CACHE STRING "Directory of HYPRE")
SET(METIS_DIR "" CACHE STRING "Directory of metis")
SET(MFEM_DIR "" CACHE STRING "Directory of mfem")

set(LAPACK_LIBRARY "")
set(BLAS_LIBRARY "")

#find_library(LAPACK_LIBRARY NAMES liblapack lapack)
#find_library(BLAS_LIBRARY NAMES libblas blas)

if(WITH_HYPRE)
    find_package(Hypre)
    if(HYPRE_FOUND)
        include_directories(${HYPRE_INCLUDE_DIRS})
	else()
	    message(FATAL_ERROR "Cannot find HYPRE. Try setting HYPRE_DIR" )
		set(WITH_HYPRE OFF)
    endif(HYPRE_FOUND)
endif(WITH_HYPRE)

if(WITH_MFEM)
	set(WITH_HYPRE ON)
	if(NOT HYPRE_FOUND)
		find_package(Hypre)
		if(HYPRE_FOUND)
			include_directories(${HYPRE_INCLUDE_DIRS})
		else()
			message(FATAL_ERROR "Cannot find HYPRE (required for MFEM). Try setting HYPRE_DIR.")
		endif(HYPRE_FOUND)
	endif(NOT HYPRE_FOUND)

	find_package(Metis)
	if(METIS_FOUND)
		include_directories(${METIS_INCLUDE_DIRS})
	else()
		message(FATAL_ERROR "Cannot find metis (required for MFEM). Try setting METIS_DIR.")
	endif(METIS_FOUND)

	find_package(Mfem)
	if (MFEM_FOUND)
		include_directories(${MFEM_INCLUDE_DIRS})
	else()
		message(FATAL_ERROR "Cannot find mfem. Try setting MFEM_DIR.")	
	endif(MFEM_FOUND)
endif(WITH_MFEM)

if (WITH_AMPI)
	add_definitions(-DUSE_AMPI)
endif(WITH_AMPI)


add_subdirectory(raptor)

if (BUILD_EXAMPLES)
  add_subdirectory(examples)
endif()
